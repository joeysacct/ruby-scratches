from StandardCardDeck import StandardCardDeck
from StandardCard import StandardCard
import random
import os
import sys
RED = '[31m'
GREEN = '[32m'
BLUE = '[34m'
GRAY = '[90m'
CYAN = '[36m'
BW = '[97m'
MAG = '[35m'
YELL = '[33m'
BLACK = '[30m'
RESET = '[0m'

def main():
    if os.name == 'nt':
        import ctypes
        kernel32 = ctypes.windll.kernel32
        kernel32.SetConsoleMode(kernel32.GetStdHandle((-11)), 7)
    safe_dir = get_safe_dir()
    game_count = 0
    reset_tricks = 0
    game_7 = True
    game_13 = True
    game_20 = True
    message = 'L.S.\nI hope this letter finds you well. We were all hoping to contact you a hair sooner than now, but time does as it may. Enclosed is a very peculiar book that we found on some of those \"outings\" I told you so much about. They are very... interesting... Please let me know what you can make of this book. It seems quite fascinating and not of this world. But please, do make haste. You and I must be sure to return it to Mr. You Know Who sooner rather than later. You know how he gets about misplaced things. Anyways, ta ta for now!\n- B'
    congrats = '.--... -.-... -.---. -----. -..-.. -..--- -.-... --.... -----. -..--- -.-... -.--.- -----. --.... -....- .--.-. -.--.- -----. --..-. -.-... -.---. -----. -..--. .----. .---.- .---.- -..-.- .----. -----. --.... -...-. -.--.- -....- ------ -----. .....- -.---. -.--.- -----. -.--.- -....- .----. -..--- -----. .--.-. -..... .--.-. -...-. -..--- -----. ..--.- .----. -...-. -.--.- -....- .----. -.-.-- -----. .---.- -...-. .---.- -----. --.... .----. ------ ------ ------ -----. .--... -.-... -.---. -.-.-- -----. -.--.. .----. .--.-. -.-.-- .---.. -....- -----. .----- -.-... -.-.-- -----. .--.-. -..--- -.--.. --.... .----. -.-.-- -.--.. -----. --.... -...-. -..-.- -..-.- -----. -..-.- .----. .--.-. .---.- -----. --..-. -.-... -.---. -----. .---.- -.-... --.... -..--- -----. -.-..- .--.-. -.--.- -....- -.--.. -----. -.---. -..--- -.--.- -.-... -----. -..--- -.-... -.--.- -....- -...-. -..--- -..... -----. .--.-- -.---. -.--.- -----. .---.- .--.-. -.-.-- -..-.. -..--- .----. -.--.. -.--.. ------ -----. ...-.- -.-... -..-.- -..-.- -.-... --.... -----. -.--.- -....- .----. -..--. ------ -----. ..-.-- .----. .--.-. .---.- -----. -.--.- -....- .----. -..--. -----. --.... -....- .----. -.-.-- .----. -----. -.--.- -....- .----. --..-. -----. -..--. .--.-. --..-. -----. -..-.- -...-. .----. ------ -----. ..-..- -.---. -.--.. -.--.- -----. .--.-. -.--.. -----. --.... .----. -----. -....- .--.-. -.---- .----. ------ -----. ..-..- -.---. -.--.. -.--.- -----. .--.-. -.--.. -----. -.--.- -....- .----. --..-. -----. --.... -...-. -..-.- -..-.- ------ -----. .-..-- -....- .----. -----. -.-..- .--.-. -.--.- -....- -----. .--.-- .----. .----- -.-... -.-.-- .----. -----. --..-. -.-... -.---. -----. -...-. -.--.. -----. .--.-. -----. -.--.- -.-.-- .----. .--.-. .---.. -....- .----. -.-.-- -.-... -.---. -.--.. -----. -.-... -..--- .----. -----. .....- -.---. -.--.- -----. -...-. -.--.- -----. -.-.-- .----. -..--. .--.-. -...-. -..--- -.--.. -----. .--.-. -.--.. -----. -.--.- -....- .----. -----. -.-... -..--- -..-.- --..-. -----. -.-..- .--.-. -.--.- -....- -----. .--.-. -....- .----. .--.-. .---.- ------ -----. .--... -.-... -.---. -----. .--.-. -.-.-- .----. -----. .----- .--.-. -.--.. -.--.- -----. .--.-. -.-..- -.-..- -.-.-- -.-... .--.-. .---.. -....- -...-. -..--- -..... -----. .--.-. -----. -.-..- -.-... -...-. -..--- -.--.- -----. -.-... .----- -----. -..--- -.-... -----. -.-.-- .----. -.--.- -.---. -.-.-- -..--- ------ -----. ...... -..--- -----. .----. -..--- .---.- ------ -----. .-..-- -....- .----. -----. ...-.. -..--- .---.- ------ -----. .--... -.-... -.---. -----. -..--. -.---. -.--.. -.--.- -----. .--.-- .----. -----. -.-..- -.-.-- .----. -.-..- .--.-. -.-.-- .----. .---.- -----. .----- -.-... -.-.-- -----. -.--.- -....- .----. -----. .---.. -.-... -..--. -...-. -..--- -..... -----. --.... -.-... -.-.-- -..-.- .---.- -----. .--.-. -..--- .---.- -----. -.--.- -....- .----. -----. .---.. -....- -.-... -...-. .---.. .----. -.--.. -----. --..-. -.-... -.---. -----. -..--. -.---. -.--.. -.--.- -----. -..--. .--.-. -..-.. .----. ------ -----. .-.--. .----. -----. --.... -...-. -..-.- -..-.- -----. .--.-- .----. -----. --.... .--.-. -.--.- .---.. -....- -...-. -..--- -..... -----. --..-. -.-... -.---. -----. .--.-. -..-.- -..-.- -----. --.... -...-. -.--.- -....- -----. -..... -.-.-- .----. .--.-. -.--.- -----. -...-. -..--- -.--.- .----. -.-.-- .----. -.--.. -.--.- ------'
    Map_of_Cyr = '-.-.---- --.-.-.. ---.-... ---..-.- -.-..... --..--.- ---....- ----.... -.-..... ---.---- ---..--. -.-..... --....-- -----..- ----..-. -.-.---- -.-..... ---.--.. ---..-.- ---..-.. -.-..... ----.-.. ---.-... ---.---- ----..-- ---..-.- -.-..... ----.--- ---.-... ---.---- -.-..... ----.--- ---....- ---.--.. ---.-.-- ---..-.- ---..-.. -.-..... ----.-.. ---.-... ---..-.- -.-..... ----.... ---....- ----.-.. ---.-... -.-..... ----.-.. ---.---- -.-..... ---..--- ----..-. ---..-.- ---....- ----.-.. -.-..... ----.... ---.---- ----.--- ---..-.- ----..-. -.-..... ---....- ---.---. ---..-.. -.-..... ----..-- ----.-.. ----..-. ---..-.- ---.---. ---..--- ----.-.. ---.-... -.-.---. -.-..... --.-.-.. ---.-... ---..-.- ---.-..- ----..-. -.-..... ----.... ---.---- ----.--- ---..-.- ----..-. ----..-- -.-..... ---..--- ----..-. ---.---- ----.--- -.-.--.. -.-..... ---....- ---.---. ---..-.. -.-..... ----.--- ---.-..- ----.-.. ---.-... -.-..... ---.-..- ----.-.. -.-.--.. -.-..... ----.-.. ---.-... ---..-.- ---.-..- ----..-. -.-..... ---..-.. ---..-.- ----..-- ----.... ---....- ---.-..- ----..-. -.-.---. -.-..... --.-.-.. ---.-... ---..-.- -----..- -.-..... ----..-. ---..-.- ---.--.- ---....- ---.-..- ---.---. -.-..... ---.-... ---.-..- ---..-.. ---..-.. ---..-.- ---.---. -.-..... ---....- ---.---. ---..-.. -.-..... ---..--- ---.---- ---.---. ---..-.- -.-.--.. -.-..... ---...-. ----.-.- ----.-.. -.-..... ----.-.. ---.-... ---..-.- -.-..... ---..--. ---.-..- ---.---. ---..-.. -.-..... ----.-.. ---.-... ---..-.- ---.-..- ----..-. -.-..... ----..-. ---.-... -----..- ----.-.. ---.-... ---.--.- -.-.---. -.-..... --.-.-.. ---.-... ---..-.- -----..- -.-..... ---...-. ---..-.- ---....- ----.-.. -.-..... ----.-.. ---.-... ---..-.- -.-..... ----.... ---....- ----.-.. ---.-... -.-.---. -.-..... --.-.-.. ---.-... ---..-.- -----..- -.-..... ---.--.- ---....- ---.-.-- ---..-.- -.-..... ---.-..- ----.-.. -.-..... ----.-.. ---.-... ---..-.- ---.-..- ----..-. -.-..... ---.---- ----.--- ---.---. -.-.---. -.-..... -.-.---- --.-.-.. ---.-... ---..-.- -.-..... --..--.- ---....- ----.... -.-..... ---.---- ---..--. -.-..... --....-- -----..- ----..-. -.-.---- -.-..... ---.--.. ---..-.- ---....- ---..-.. ----..-- -.-..... ----.-.. ---.-... ---..-.- ---.--.- -.-..... ----.-.. ---.---- -.-..... ----.-.. ---.-... ---..-.- -.-..... ---..--- ----..-. ---..-.- ---....- ----.-.. -.-..... ----.... ---.---- ----.--- ---..-.- ----..-. -.-..... ---....- ---.---. ---..-.. -.-..... ----..-. ---.-..- ---...-- ---.-... ---..-.- ----..-- -.-..... ----.-.. ---.-... ---....- ----.-.. -.-..... ----.-.. ---.-... ---..-.- -----..- -.-..... ----..-- ---..-.- ---..-.- ---.-.-- -.-.--.. -.-..... ----.--- ---.-... ---....- ----.-.. ---..-.- ----.--. ---..-.- ----..-. -.-..... ----.-.. ---.-... ---..-.- -----..- -.-..... ---.--.- ---....- -----..- -.-..... ---...-. ---..-.- -.-.---. -.-..... --....-. ----.-.- ----.-.. -.-..... ---.-..- ----.-.. -.-..... ---...-- ---.---- ---.--.- ---..-.- ----..-- -.-..... ----.--- ---.-..- ----.-.. ---.-... -.-..... ---....- -.-..... ---...-- ---.---- ----..-- ----.-.. -.-.---. -.-..... --.....- -.-..... ---..--- ----..-. ---..-.- ---....- ----.-.. -.-..... ---...-- ---.---- ----..-- ----.-.. -.-.---. -.-..... --...--. ---.---- ---.--.. ---.--.. ---.---- ----.--- ---.-..- ---.---. ---..--- -.-..... -.-.---- --.-.-.. ---.-... ---..-.- -.-..... --..--.- ---....- ----.... -.-..... ---.---- ---..--. -.-..... --....-- -----..- ----..-. -.-.---- -.-..... ---.-..- ----..-- -.-..... ---.---- ---..--. ----.-.. ---..-.- ---.---. -.-..... ---....- -.-..... ---..-.. ---..-.- ---...-- ---.-..- ----..-- ---.-..- ---.---- ---.---. -.-..... ---.--.- ---....- ---..-.. ---..-.- -.-..... ----.--- ---.-..- ----.-.. ---.-... -.-..... ----..-. ---..-.- ---..--- ----..-. ---..-.- ----.-.. -.-..... ---.-..- ---.---. -.-..... ----..-. ---..-.- ----.-.. ----..-. ---.---- ----..-- ----.... ---..-.- ---...-- ----.-.. -.-.---. -.-..... --....-. ----.-.- ----.-.. -.-.--.. -.-..... ---.--.- ---....- ---.---. -----..- -.-..... ----..-- ----.-.. ---.-..- ---.--.. ---.--.. -.-..... ---.--.- ---....- ---.-.-- ---..-.- -.-..... ----.-.. ---.-... ---..-.- -.-..... ---.-.-. ---.---- ----.-.- ----..-. ---.---. ---..-.- -----..- -.-.--.. -.-..... ---..--. ---.---- ----..-. -.-..... ----.-.. ---.-... ---..-.- -.-..... ----.... ---....- ----.-.. ---.-... -.-..... ---.-..- ----..-- -.-..... ---..--- ----..-. ---..-.- ---....- ----.-.. -.-..... ---....- ---.---. ---..-.. -.-..... ----.-.. ---..-.- ----..-. ----..-. ---.-..- ---...-. ---.--.. ---..-.- -.-.---.'
    Vow = '.-.-.-.. .--.---- .--..-.. .--....- .----..- ..-.--.. ..-..... .---.--- .--..-.- ..-..... .--....- .---..-. .--..-.- ..-..... .--..--- .--....- .---.-.. .--.-... .--..-.- .---..-. .--..-.- .--..-.. ..-..... .--.-... .--..-.- .---..-. .--..-.- ..-..... .---.-.. .--.---- ..-..... .--..--. .--.---- .---..-. .--.--.- ..-..... .--....- ..-..... .--.---. .--..-.- .---.--- ..-..... .--.---- .---..-. .--..--- .--....- .--.---. .--.-..- .---..-- .--.--.- ..-.---. ..-..... .-.-..-- .--.---- .--.--.- .--..-.- .---.-.. .--.-... .--.-..- .--.---. .--..--- ..-..... .--.-... .--.-..- .--..-.. .--..-.. .--..-.- .--.---. ..-.--.. ..-..... .--...-. .---.-.- .---.-.. ..-..... .---.... .--.---- .---.--- .--..-.- .---..-. .--..--. .---.-.- .--.--.. ..-.---. ..-..... .-.-.--- .--..-.- ..-..... .---.--- .--.-..- .--.--.. .--.--.. ..-..... .---.--- .--.---- .---..-. .--.-.-- ..-..... .---.-.. .--.---- .--..--- .--..-.- .---.-.. .--.-... .--..-.- .---..-. ..-..... .---.-.. .--.---- ..-..... .--....- .--...-- .--.-... .--.-..- .--..-.- .---.--. .--..-.- ..-..... .--.---- .---.-.- .---..-. ..-..... .--..-.- .--.---. .--..-.. .---..-- ..-.---. ..-..... .-.-.-.. .--.---- ..-..... .--....- .--...-- .--.-... .--.-..- .--..-.- .---.--. .--..-.- ..-..... .--.---- .---.-.- .---..-. ..-..... .---..-. .---.-.- .--.--.. .--..-.- .---..-. .---..-- .--.-... .--.-..- .---.... ..-.---. ..-..... .-.-.-.. .--.---- ..-..... .--..-.- .--.---. .---..-- .---.-.- .---..-. .--..-.- ..-..... .--.---- .---.-.- .---..-. ..-..... .--..-.- .---..-- .--...-- .--....- .---.... .--..-.- ..-.---. ..-..... .-.-.--- .--..-.- ..-..... .---.--- .--.-..- .--.--.. .--.--.. ..-..... .---.-.. .--....- .--.-.-- .--..-.- ..-..... .---.-.- .---.... ..-..... .--....- ..-..... .--.---. .--..-.- .---.--- ..-..... .--.--.- .--....- .--.---. .---.-.. .--.--.. .--..-.- ..-.--.. ..-..... .--....- .--.---. .--..-.. ..-..... .--...-. .---..-. .--.-..- .--.---. .--..--- ..-..... .--....- .--...-. .--.---- .---.-.- .---.-.. ..-..... .---.-.. .--.-... .--..-.- ..-..... .-..---. .--..-.- .---.--- ..-..... .-.-.--- .--.---- .---..-. .--.--.. .--..-.. ..-..... .---.--- .--.-..- .---.-.. .--.-... ..-..... .---.--- .--.-... .--.-..- .--...-- .--.-... ..-..... .---.--- .--..-.- ..-..... .---..-- .--.-... .--.---- .---.-.- .--.--.. .--..-.. ..-..--- .---.--. .--..-.- ..-..... .--....- .--.--.. .---.--- .--....- .----..- .---..-- ..-..... .--...-. .--..-.- .--..-.- .--.---. ..-..... .---..-. .---.-.- .--.--.. .--..-.- .---..-. .---..-- ..-.---. ..-..... .-.....- .--.---. .--..-.. ..-..... .---.--- .--.-... .--....- .---.-.. ..-..... .--...-. .--..-.- .---.-.. .---.-.. .--..-.- .---..-. ..-..... .--....- ..-..... .--.---. .--....- .--.--.- .--..-.- ..-..... .---.-.. .--.---- ..-..... .---.... .--.-..- .--...-- .--.-.-- ..-.--.. ..-..... .---.-.. .--.-... .--....- .--.---. ..-..... .---.-.. .--.-... .--..-.- ..-..... .--.--.- .--.---- .--.---. .--.-..- .--.-.-- .--..-.- .---..-. ..-..... .--.---- .--..--. ..-..... .---.-.. .--.-... .--.---- .---..-- .--..-.- ..-..... .--..--. .--.---- .--.---- .--.--.. .---..-- ..-..... .-..-..- ..-..... .--..-.. .--..-.- .--....- .--.--.. .---.-.. ..-..... .---.--- .--.-..- .---.-.. .--.-... ..-..... .---..-- .--.---- ..-..... .--.--.. .--.---- .--.---. .--..--- ..-..... .--....- .--..--- .--.---- ..-.---. ..-.---. ..-.---. ..-..... .-.-.--- .--..-.- ..-..... .---..-- .--..-.- .---.--. .--..-.- .--.---. ..-..... .---.--- .--.-..- .--.--.. .--.--.. ..-..... .---..-- .---.--- .--..-.- .--....- .---..-. ..-..... .---.-.. .--.---- ..-..... .---..-- .--..-.- .--..-.- ..-..... .---.-.. .--.-... .--.-..- .---..-- ..-..... .---.-.. .--.-... .---..-. .--.---- .---.-.- .--..--- .--.-... ..-.---. ..-.---. ..-.---.'
    if game_count >= 0:
        switch_tricks = 0
        game_count += 1
        input_7 = True
        input_13 = True
        input_20 = True
        path_trig = True
        hand = True
        deck = StandardCardDeck()
        player_hand = StandardCardDeck(hand)
        NPC_hand = StandardCardDeck(hand)
        player_tricks = reset_tricks
        NPC_tricks = reset_tricks
        print(f'\n{CYAN}Welcome to Go Fysh!{RESET}')
        print('Shuffling deck...')
        deck.shuffle()
        print(f'drawing cards...\n{CYAN}')
        player_hand.add(deck.draw(7))
        NPC_hand.add(deck.draw(7))
        print('================================================================')
        print(f'\n{RESET}{YELL}Your Starting Hand:{RESET}\n{player_hand:long}')
        print(f'{CYAN}')
        print('================================================================')
        print(f'{RESET}')
        if len(player_hand) > 0 and len(NPC_hand) > 0:
            print(f'Checking for {YELL}Your{RESET} {CYAN}Tricks{RESET}...')
            player_tricks += tricks(player_hand)
            print(f'\nChecking for {MAG}Opponent{RESET} {CYAN}Tricks{RESET}...')
            NPC_tricks += tricks(NPC_hand)
            if len(player_hand) > 0 and (not len(NPC_hand) > 0):
                pass  # postinserted
            break
        print(f'{CYAN}')
        print('================================================================')
        print(f'{CYAN}')
        print(f'{BW}GAME OVER!{RESET}')
        print(f'{BLACK}The Path...{RESET}')
        if player_tricks == 7:
            print(f'{RED}Player{RESET} {YELL}Score:{RESET} {RED}{player_tricks}{RESET}\n')
        if NPC_tricks == 7:
            print(f'{RED}ArtSym{RESET} {MAG}Score:{RESET} {RED}{NPC_tricks}{RESET}\n')
        if player_tricks == 7:
            if reset_tricks < 7:
                switch_tricks = 1
        match switch_tricks:
            pass  # postinserted
        case 0:
            pass  # postinserted
        if player_tricks > NPC_tricks:
            print(f'{GREEN}YOU WIN!{RESET}')
        if game_count >= 7 and game_7:
            print(f'{RED}RESOLVED: We will be made anew.{RESET}')
            game_7 = False
            print(f'{RED}\n{Vow}\n{RESET}')
            try:
                with open(os.path.join(safe_dir, 'A_New_Vow.txt'), 'w') as file:
                    file.write(Vow)
        again = input(f'Would you like to play again? ({GREEN}Y{RESET}/{RED}N{RESET})').capitalize()
        if again!= 'Y' and again!= 'N':
            again = input(f'Invalid input. Would you like to play again? ({GREEN}Y{RESET}/{RED}N{RESET})').capitalize()
        if again == 'N':
            pass  # postinserted
        break

def remove_trick(response, player_hand, NPC_hand):
    for i, card in enumerate(player_hand):
        if response == card.rank:
            pass  # postinserted
        else:  # inserted
            player_hand.remove(player_hand[i])
    for i, card in enumerate(NPC_hand):
        if response == card.rank:
            pass  # postinserted
        else:  # inserted
            NPC_hand.remove(NPC_hand[i])

def tricks(hand) -> int:
    trick = 0
    matches = []
    used_indexes = set()
    cards = hand.cards
    for i, card in enumerate(cards):
        if i in used_indexes:
            continue
        for j in range(i + 1, len(cards)):
            other = cards[j]
            if j in used_indexes:
                continue
            if card == other and (not card.equals_exact(other)):
                pass  # postinserted
            else:  # inserted
                print(f'{CYAN}Trick!{RESET}')
                print(f'{card} and {other}')
                trick += 1
                matches.append(card)
                matches.append(other)
                used_indexes.update([i, j])
                break
    for card in matches:
        hand.remove(card)
    return trick

def get_safe_dir():
    """\nReturns the directory where the running script (or .exe) is located.\nWorks whether frozen with PyInstaller or not.\n"""  # inserted
    return os.path.dirname(sys.executable) if getattr(sys, 'frozen', False) else os.path.dirname(os.path.abspath(__file__))
if __name__ == '__main__':
    main()